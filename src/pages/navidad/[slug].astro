---
import Layout from '../../layouts/Layout.astro';
import InfoVelas from '../../components/InfoVelas.astro';

// Desactivar prerenderizado para carga dinámica desde la API
export const prerender = false;

const slug = Astro.params.slug || '';
---

<Layout>
  <div class="pagina-producto">
    <div id="breadcrumb-container"></div>

    <section class="producto-grid">
      <div class="container">
        <div id="product-detail-container" class="product-detail-container">
          <!-- El producto se cargará dinámicamente aquí -->
        </div>
      </div>
    </section>

    <InfoVelas />
  </div>

  <script is:inline define:vars={{ slug }}>
    (function() {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initDetail);
      } else {
        initDetail();
      }
      
      function initDetail() {
        if (window.initProductDetail && slug) {
          window.initProductDetail(slug, {
            containerSelector: '#product-detail-container',
            autoLoad: true
          }).then(() => {
            updateBreadcrumb();
          });
        } else {
          setTimeout(initDetail, 100);
        }
      }
      
      function updateBreadcrumb() {
        const container = document.getElementById('breadcrumb-container');
        const productContainer = document.getElementById('product-detail-container');
        
        if (container && productContainer) {
          const h1 = productContainer.querySelector('h1');
          const productName = h1 ? h1.textContent : 'Producto Navidad';
          
          container.innerHTML = `
            <div class="breadcrumb">
              <div class="container">
                <a href="/">Inicio</a>
                <span class="separator">/</span>
                <a href="/navidad">Navidad</a>
                <span class="separator">/</span>
                <span class="current">${productName}</span>
              </div>
            </div>
          `;
        }
      }
    })();
  </script>
</Layout>
